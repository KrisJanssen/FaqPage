"use strict";function RequestError(n){n instanceof SP.ClientRequestFailedEventArgs?(this.stackTrace=n.get_stackTrace(),this.message=n.get_message(),this.correlation=n.get_errorTraceCorrelationId(),this.errorCode=n.get_errorCode(),this.details=n.get_errorDetails(),this.errorType=n.get_errorTypeName()):typeof n=="string"&&(this.message=n)}function ListRepository(n,t){var i=Function.validateParameters(arguments,[{name:"_listTitle",type:String},{name:"listItemConstractor",type:Function}],!0);if(i)throw i;this._listUrl=n;this._listItemConstructor=t;this._context=SP.ClientContext.get_current();this._loadListDeffered=FAQ.ListService.getListByUrl(this._listUrl);this._loadListDeffered.done(Function.createDelegate(this,function(n){this._list=n}));this.folder=null}function BaseListItem(n){var t=Function.validateParameters(arguments,[{name:"item",type:SP.ListItem}],!0);if(t)throw t;this.item=n;this.id=n.get_id();this.created=n.get_item(FAQ.Fields.Created);this.createdBy=n.get_item(FAQ.Fields.CreatedBy);this.modified=n.get_item(FAQ.Fields.Modified);this.modifiedBy=n.get_item(FAQ.Fields.ModifiedBy);this.title=n.get_item(FAQ.Fields.Title)}function FaqRepository(n){FaqRepository.initializeBase(this,[n,FaqListItem])}function AppPartsConfigRepository(n){AppPartsConfigRepository.initializeBase(this,[n,AppPartConfigListItem])}function FaqListItem(n){if(n){FaqListItem.initializeBase(this,[n]);this.question=n.get_item(FAQ.Fields.FaqList.Question);this.answer=n.get_item(FAQ.Fields.FaqList.Answer);this.order=n.get_item(FAQ.Fields.FaqList.Order);this.expanded=n.get_item(FAQ.Fields.FaqList.Expanded);var t=n.get_item(FAQ.Fields.FaqList.FolderSettings);this.faqSetSettings=t?JSON.parse(t):{}}}function AppPartConfigListItem(n){n&&(AppPartConfigListItem.initializeBase(this,[n]),this.wpId=n.get_item(FAQ.Fields.AppPartsConfig.AppPartId),this.configData=JSON.parse(n.get_item(FAQ.Fields.AppPartsConfig.Config)))}Type.registerNamespace("FAQ.Fields.FaqList");Type.registerNamespace("FAQ.Fields.AppPartsConfig");Type.registerNamespace("FAQ.Lists");Type.registerNamespace("FAQ.ErrorCodes");Type.registerNamespace("FAQ.ContentTypes");FAQ.ErrorCodes.FolderAlreadyExists=-2130245363;FAQ.ErrorCodes.IllegalName=-2130575245;FAQ.Lists.FaqUrl="Lists/Faq";FAQ.Lists.AppPartsConfigUrl="Lists/AppPartsConfig";FAQ.Fields.Modified="Modified";FAQ.Fields.Created="Created";FAQ.Fields.ModifiedBy="Editor";FAQ.Fields.CreatedBy="Author";FAQ.Fields.ID="ID";FAQ.Fields.FSObjType="FSObjType";FAQ.Fields.Title="Title";FAQ.Fields.FileLeafRef="FileLeafRef";FAQ.Fields.ContentTypeId="ContentTypeId";FAQ.Fields.FaqList.Question="FAQQuestion";FAQ.Fields.FaqList.Answer="FAQAnswer";FAQ.Fields.FaqList.Order="FAQOrder";FAQ.Fields.FaqList.Expanded="FAQExpanded";FAQ.Fields.FaqList.FolderSettings="FAQFolderSettings";FAQ.Fields.AppPartsConfig.AppPartId="WebPartId";FAQ.Fields.AppPartsConfig.Config="WebPartConfig";FAQ.ContentTypes.FaqFodlerId="0x012000B611673586B24704B0EF576127543759";RequestError.registerClass("RequestError");FAQ.ListService=function(){var n=$jq.Deferred(),t=SP.ClientContext.get_current(),i=t.get_web().get_lists();return t.load(i,"Include(DefaultViewUrl)"),t.executeQueryAsync(function(){n.resolve()},function(t,i){n.reject(new RequestError(i));alert(String.fromat(FAQRS.ErrorLoadingList))}),{getListByUrl:function(t){var r=$jq.Deferred();return n.done(function(){for(var u=i.getEnumerator(),n;u.moveNext();)if(n=u.get_current(),n.get_defaultViewUrl().indexOf(t)!=-1){r.resolve(n);return}}),r.promise()}}}();ListRepository.prototype={getItems:function(){return this._getItemsByQuery(SP.CamlQuery.createAllItemsQuery())},getItemById:function(n){var i=Function.validateParameters(arguments,[{name:"id",type:Number}],!0),t;if(i)throw i;return t=this._createDeferred(),this._loadListDeffered.done(Function.createDelegate(this,function(){var i=this._list.getItemById(n),r;this._context.load(i);r=this;this._context.executeQueryAsync(function(){var n=new r._listItemConstructor(i);t.resolve(n)},function(n,i){t.reject(new RequestError(i))})})),t.promise},getLastItem:function(){var t=new CamlBuilder,i=t.Where().CounterField(FAQ.Fields.ID).NotEqualTo(0).OrderByDesc(FAQ.Fields.ID).ToString(),n=new SP.CamlQuery;return n.set_viewXml(String.format("<View><Query>{0}<\/Query><RowLimit>1<\/RowLimit><\/View>",i)),this._getItemByQuery(n)},getRootFolders:function(){var n=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var u=new CamlBuilder,f=u.Where().IntegerField(FAQ.Fields.FSObjType).EqualTo(1).ToString(),i=new SP.CamlQuery,t,r;i.set_viewXml(String.format("<View><Query>{0}<\/Query><\/View>",f));t=this._list.getItems(i);r=this;this._context.load(t);this._context.executeQueryAsync(function(){for(var u=[],f=t.getEnumerator(),i;f.moveNext();)(i=f.get_current(),i.get_item(FAQ.Fields.Title)!=="Item")&&u.push(new r._listItemConstructor(i));n.resolve(u)},function(t,i){n.reject(new RequestError(i))})})),n.promise},saveItem:function(n){var t=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0);if(t)throw t;return!n.id||n.id<1?this._addItem(n):this._updateItem(n)},deleteItem:function(n){var i=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0),t;if(i)throw i;return t=this._createDeferred(),this._loadListDeffered.done(Function.createDelegate(this,function(){var i=this._list.getItemById(n.id);this._context.load(i);i.deleteObject();this._context.executeQueryAsync(function(){t.resolve()},function(n,i){t.reject(new RequestError(i))})})),t.promise},createFolder:function(n){var i=Function.validateParameters(arguments,[{name:"folderName",type:String}],!0),t;if(i)throw i;return t=this._createDeferred(),this._loadListDeffered.done(Function.createDelegate(this,function(){var r=new SP.ListItemCreationInformation,i;r.set_underlyingObjectType(SP.FileSystemObjectType.folder);r.set_leafName(n);i=this._list.addItem(r);i.set_item("Title",n);i.update();this._context.load(i);this._context.executeQueryAsync(function(){t.resolve(i)},function(n,i){t.reject(new RequestError(i))})})),t.promise},_createDeferred:function(){return angular.injector(["ng"]).get("$q").defer()},_addItem:function(n){var i=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0),t;if(i)throw i;return t=this._createDeferred(),this._loadListDeffered.done(Function.createDelegate(this,function(){var r=new SP.ListItemCreationInformation,i,u;this.folder&&r.set_folderUrl(this._getFolderRelativeUrl());i=this._list.addItem(r);this._setFieldValues(i,n);u=this;i.update();this._context.load(i);this._context.executeQueryAsync(function(){var n=new u._listItemConstructor(i);t.resolve(n)},function(n,i){t.reject(new RequestError(i))})})),t.promise},_updateItem:function(n){var i=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0),t;if(i)throw i;return t=this._createDeferred(),this._loadListDeffered.done(Function.createDelegate(this,function(){var i=this._list.getItemById(n.id),r;this._context.load(i);this._setFieldValues(i,n);r=this;i.update();this._context.executeQueryAsync(function(){var n=new r._listItemConstructor(i);t.resolve(n)},function(n,i){t.reject(new RequestError(i))})})),t.promise},_setFieldValues:function(n,t){n.set_item(FAQ.Fields.Title,t.title);t.fileLeafRef&&n.set_item(FAQ.Fields.FileLeafRef,t.fileLeafRef)},_getFolderRelativeUrl:function(){var n=_spPageContextInfo.webServerRelativeUrl.endsWith("/")?_spPageContextInfo.webServerRelativeUrl:_spPageContextInfo.webServerRelativeUrl+"/";return String.format("{0}{1}/{2}",n,this._listUrl,this.folder)},_getItemsByQuery:function(n){var i=Function.validateParameters(arguments,[{name:"camlQuery",type:SP.CamlQuery}],!0),t;if(i)throw i;return t=this._createDeferred(),this._loadListDeffered.done(Function.createDelegate(this,function(){var i,r;this.folder&&n.set_folderServerRelativeUrl(this._getFolderRelativeUrl());i=this._list.getItems(n);this._context.load(i);r=this;this._context.executeQueryAsync(function(){for(var n=i.getEnumerator(),u=[];n.moveNext();)u.push(new r._listItemConstructor(n.get_current()));t.resolve(u)},function(n,i){t.reject(new RequestError(i))})})),t.promise},_getItemByQuery:function(n){var i=Function.validateParameters(arguments,[{name:"camlQuery",type:SP.CamlQuery}],!0),t;if(i)throw i;return t=this._createDeferred(),this._loadListDeffered.done(Function.createDelegate(this,function(){var i,r;this.folder&&n.set_folderServerRelativeUrl(this._getFolderRelativeUrl());i=this._list.getItems(n);this._context.load(i);r=this;this._context.executeQueryAsync(function(){for(var u=i.getEnumerator(),n=[];u.moveNext();)n.push(new r._listItemConstructor(u.get_current()));if(n.length>1)throw"Result contains more than one element";t.resolve(n.length===1?n[0]:null)},function(n,i){t.reject(new RequestError(i))})})),t.promise}};ListRepository.registerClass("ListRepository");BaseListItem.registerClass("BaseListItem");FaqRepository.prototype={_setFieldValues:function(n,t){FaqRepository.callBaseMethod(this,"_setFieldValues",[n,t]);n.set_item(FAQ.Fields.FaqList.Question,t.question);n.set_item(FAQ.Fields.FaqList.Answer,t.answer);n.set_item(FAQ.Fields.FaqList.Order,t.order);n.set_item(FAQ.Fields.FaqList.Expanded,t.expanded);t.faqSetSettings&&n.set_item(FAQ.Fields.FaqList.FolderSettings,JSON.stringify(t.faqSetSettings))},createFaqFolder:function(n,t){var i=this._createDeferred(),r=this;return this.createFolder(n).then(function(n){n.set_item(FAQ.Fields.FaqList.FolderSettings,JSON.stringify(t));n.update();r._context.load(n);r._context.executeQueryAsync(function(){i.resolve(n)},function(n,t){i.reject(new RequestError(t))})},function(n){i.reject(n)}),i.promise},getOrderedItems:function(){var t=new CamlBuilder,i=t.Where().CounterField(FAQ.Fields.ID).NotEqualTo(0).OrderBy(FAQ.Fields.FaqList.Order).ToString(),n=new SP.CamlQuery;return n.set_viewXml(String.format("<View><Query>{0}<\/Query><\/View>",i)),this._getItemsByQuery(n)},updateOrdering:function(n){function o(t){var i=null;return Array.forEach(n,function(n){n.id===t&&(i=n)}),i}var r=Function.validateParameters(arguments,[{name:"faqItems",type:Array,elementType:FaqListItem}]),t;if(r)throw r;var u=n.map(function(n){return n.id}),f=new CamlBuilder,e=f.Where().CounterField(FAQ.Fields.ID).In(u).ToString(),i=new SP.CamlQuery;return i.set_viewXml(String.format("<View><Query>{0}<\/Query><\/View>",e)),t=this._createDeferred(),this._loadListDeffered.done(Function.createDelegate(this,function(){this.folder&&i.set_folderServerRelativeUrl(this._getFolderRelativeUrl());var n=this._list.getItems(i);this._context.load(n);this._context.executeQueryAsync(Function.createDelegate(this,function(){for(var r=n.getEnumerator(),i,u;r.moveNext();)i=r.get_current(),u=o(i.get_id()),i.set_item(FAQ.Fields.FaqList.Order,u.order),i.update();this._context.executeQueryAsync(function(){t.resolve()},function(n,i){t.reject(new RequestError(i))})}),function(n,i){t.reject(new RequestError(i))})})),t.promise}};FaqRepository.registerClass("FaqRepository",ListRepository);AppPartsConfigRepository.prototype={_setFieldValues:function(n,t){AppPartsConfigRepository.callBaseMethod(this,"_setFieldValues",[n,t]);n.set_item(FAQ.Fields.AppPartsConfig.AppPartId,t.wpId);n.set_item(FAQ.Fields.AppPartsConfig.Config,JSON.stringify(t.configData))},getByAppPartId:function(n){var i=new CamlBuilder,r=i.Where().TextField(FAQ.Fields.AppPartsConfig.AppPartId).EqualTo(n).ToString(),t=new SP.CamlQuery;return t.set_viewXml(String.format("<View><Query>{0}<\/Query><\/View>",r)),this._getItemByQuery(t)}};AppPartsConfigRepository.registerClass("AppPartsConfigRepository",ListRepository);FaqListItem.registerClass("FaqListItem",BaseListItem);AppPartConfigListItem.registerClass("AppPartConfigListItem",BaseListItem);FAQ.SPWebService=function(){function n(n){for(var i,r=document.URL.split("?")[1].split("&"),t=0;t<r.length;t=t+1)if(i=r[t].split("="),i[0]==n)return i[1]}return{getHostWebId:function(){var t=angular.injector(["ng"]).get("$q").defer(),u=decodeURIComponent(n("SPHostUrl")),i=SP.ClientContext.get_current(),f=new SP.AppContextSite(i,u),r=f.get_web();return i.load(r),i.executeQueryAsync(function(){t.resolve(r.get_id().toString())},function(n,i){t.reject(new RequestError(i))}),t.promise},webProperties:{get:function(n){var t=angular.injector(["ng"]).get("$q").defer(),i=new SP.ClientContext.get_current,r=i.get_web().get_allProperties();return i.load(r),i.executeQueryAsync(function(){t.resolve(r.get_fieldValues()[n])},function(n,i){t.reject(new RequestError(i))}),t.promise},set:function(n,t){var i=angular.injector(["ng"]).get("$q").defer(),r=new SP.ClientContext.get_current,u=r.get_web(),f=u.get_allProperties();return r.load(f),r.executeQueryAsync(function(){f.set_item(n,t);u.update();r.executeQueryAsync(function(){i.resolve()},function(n,t){i.reject(new RequestError(t))})},function(n,t){i.reject(new RequestError(t))}),i.promise}}}}();
//# sourceMappingURL=core_bundle.min.js.map
