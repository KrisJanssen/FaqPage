!function(){"use strict";angular.module("FaqApp.controllers",[]),angular.module("FaqApp.services",[]),angular.module("FaqApp.directives",[]),angular.module("FaqApp.filters",[]),angular.module("ViewFaqApp",["FaqApp.controllers","FaqApp.services","FaqApp.directives","FaqApp.filters","ngRoute","ngSanitize","ngAnimate","ui.bootstrap","ui.sortable"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"partials/FaqList.html",controller:"FaqViewCtrl"}).otherwise({redirectTo:"/"})}]).config(["$logProvider",function(a){a.debugEnabled(window.faq_is_debug)}]),angular.module("EditFaqApp",["FaqApp.controllers","FaqApp.services","FaqApp.directives","ngRoute","ngSanitize","ngAnimate","ui.bootstrap","ui.sortable","ngToast"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"partials/EditMode/FaqEditStartScreen.html",controller:"FaqEditCtrl"}).when("/SelectForEdit",{templateUrl:"partials/EditMode/SelectFaqSetForEdit.html",controller:"SelectFaqForEditCtrl"}).when("/ConnectFaqSet",{templateUrl:"partials/EditMode/ConnectFaqSet.html",controller:"ConnectFaqSetCtrl"}).when("/NewFaqSet",{templateUrl:"partials/EditMode/NewFaqSet.html",controller:"FaqEditCtrl"}).when("/ManageFaqSet/:folderUrl",{templateUrl:"partials/EditMode/ManageFaqSet.html",controller:"ManageFaqSetCtrl"}).when("/ManageFaqSet/:folderUrl/faq/edit/:faqId",{templateUrl:"partials/EditMode/CreateEditFaq.html",controller:"CreateEditFaqCtrl"}).when("/ManageFaqSet/:folderUrl/faq/new",{templateUrl:"partials/EditMode/CreateEditFaq.html",controller:"CreateEditFaqCtrl"}).when("/Licensing",{templateUrl:"partials/EditMode/LicenseRequest.html",controller:"RegisterAppCtrl"}).when("/ContactDev",{templateUrl:"partials/EditMode/ContactDeveloper.html",controller:"ContactDeveloperCtrl"}).otherwise({redirectTo:"/"})}]).config(["$logProvider",function(a){a.debugEnabled(window.faq_is_debug)}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("CommonFaqSetSettingsCtrl",["$scope","faqService","processing","$routeParams","$timeout","$jq","animationList","ngToast",function(a,b,c,d,e,f,g,h){c.initilize(a);var i;a.viewDeferred=b.faqRepository.getRootFolders(),a.viewDeferred.then(function(b){i=f.grep(b,function(a){return a.title===d.folderUrl?!0:!1})[0],a.faqSettings=i.faqSetSettings,a.setSelectedAnimation(a.faqSettings.animation)}),a.setSelectedAnimation=function(b){a.selectedAnimation=g[b],a.playingAnimation=b,a.faqSettings.animation=b},a.testAnimation=function(){a.playingAnimation=a.faqSettings.animation},a.saveSettings=function(){i.faqSetSettings=a.faqSettings,a.viewDeferred=b.faqRepository.saveItem(i),h.create({content:a.Resources.DataSaved})}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ConnectFaqSetCtrl",["processing","$scope","$q","$jq","faqService","context","ngToast",function(a,b,c,d,e,f,g){a.initilize(b);var h=f.wpId;b.viewDeferred=c.all([e.faqRepository.getRootFolders(),e.appPartConfigRepository.getByAppPartId(h)]),b.viewDeferred.then(function(a){b.folders=a[0];var c=a[1];if(c){var e=d.grep(b.folders,function(a){return a.id===c.configData.folderId?!0:!1})[0];e.title=e.title+" "+b.Resources.CurrentlySelected,b.folder=e}else b.folders&&b.folders.length&&(b.folder=b.folders[0])},function(a){alert(a.message)}),b.connectAppPart=function(a){e.appPartConfigRepository.getByAppPartId(h).then(function(c){c||(c=new AppPartConfigListItem,c.wpId=h,c.configData={}),c.configData.folderId=a.id,e.appPartConfigRepository.saveItem(c).then(function(){g.create({content:b.Resources.DataSaved}),b.$apply()},function(a){alert(a.message)})},function(a){alert(a.message)})}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ContactDeveloperCtrl",["$scope","processing",function(a,b){b.initilize(a)}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("CreateEditFaqCtrl",["$scope","$sce","$routeParams","$q","faqService","processing","ngToast",function(a,b,c,d,e,f,g){function h(){a.faqItem=i,a.$watch("faqItem.question",function(){a.question=a.getInnerText(i.question)}),a.$watch("faqItem.answer",function(){a.answer=a.getInnerText(i.answer)}),a.saveFaq=function(){if(a.submitted=!0,!a.faqForm.$invalid){var b=d.defer();a.viewDeferred=b.promise,e.faqRepository.getLastItem().then(function(d){i.order||(i.order=d?d.id+1:1),e.faqRepository.saveItem(i).then(function(){g.create({content:a.Resources.QuestionSaved}),b.resolve(),a.go(String.format("/ManageFaqSet/{0}",c.folderUrl))},function(a){b.resolve(),alert(a.message)})},function(a){b.resolve(),alert(a.message)})}},a.back=function(){a.go(String.format("/ManageFaqSet/{0}",c.folderUrl))}}f.initilize(a);var i;e.faqRepository.folder=c.folderUrl,c.faqId?e.faqRepository.getItemById(parseInt(c.faqId,10)).then(function(b){i=b,h(),a.$apply()},function(a){alert(a.message)}):(i=new FaqListItem,i.expanded=!0,h())}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("FaqEditCtrl",["$scope","$sce","faqService","$location","faqSetModel","processing","context",function(a,b,c,d,e,f,g){f.initilize(a),e.faqSetName="",a.faqSetModel=e,a.wpIdProvided=!!g.wpId,a.newFaqSet=function(){a.submitted=!0,a.faqForm.$invalid||(a.createFolderDeferred=c.faqRepository.createFaqFolder(e.faqSetName,{useAnimation:!1,showPlusSymbol:!0,animation:"cshow",searchEnabled:!1}),a.createFolderDeferred.then(function(){a.go(String.format("/ManageFaqSet/{0}",e.faqSetName)),a.$apply()},function(b){a.folderExists=b.errorCode===FAQ.ErrorCodes.FolderAlreadyExists,a.illegalCharacter=b.errorCode===FAQ.ErrorCodes.IllegalName,a.folderExists||a.illegalCharacter||(a.commonError=!0,a.errorMessage=b.message),a.$apply()}))}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("FaqViewCtrl",["$scope","$sce","$q","$timeout","faqService","processing","context","$log","$window",function(a,b,c,d,e,f,g,h,i){f.initilize(a);var j,k=2,l=200;if(a.faqItems=null,a.appPartInitialized=!0,g.editMode){var m=String.format("{0}FaqAppPartEditMode.aspx{1}/#/ConnectFaqSet",g.spAppWebUrl,i.location.search);return h.debug(m),void(i.location.href=m)}var n=g.wpId,o=c.defer();a.viewDeferred=o.promise,a.changeVisibility=function(b,c){a.forceExpand||(c.playingAnimation=j.faqSetSettings.animation,b.isShown=!b.isShown,b.expanded=!b.expanded)},a.clearSearch=function(){a.searchText&&(a.searchText="",d(function(){e.resizeParent()},100))},a.filterByQuestionAnswer=function(b){if(!a.searchText)return!0;var c=a.searchText.toLowerCase();return-1!==b.question.toLowerCase().indexOf(c)||-1!==b.answer.toLowerCase().indexOf(c)},a.resize=function(){d(function(){e.resizeParent()},100)},e.appPartConfigRepository.getByAppPartId(n).then(function(b){b?e.faqRepository.getItemById(b.configData.folderId).then(function(b){j=b,e.faqRepository.folder=j.title,a.playingAnimation=j.faqSetSettings.animation,a.showPlusSymbol=j.faqSetSettings.showPlusSymbol,a.forceExpand=j.faqSetSettings.useAnimation===!1,a.showSearch=j.faqSetSettings.searchEnabled,e.faqRepository.getItems().then(function(b){Array.forEach(b,function(a){a.isShown=a.expanded}),a.faqItems=b,o.resolve(),a.$apply(),e.resizeParent(),h.debug("faqService.resizeParent()");var c=setInterval(function(){k--,0===k&&clearInterval(c),e.resizeParent(),h.debug("faqService.resizeParent() - interval")},1*l)},function(a){o.resolve(),alert(a.message)})},function(a){o.resolve(),alert(a.message)}):(a.appPartInitialized=!1,o.resolve(),a.$apply())},function(a){o.resolve(),alert(a.message)})}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("LicensingCtrl",["$scope","faqService","$location","$q","processing","licenseStatus","licensing",function(a,b,c,d,e,f,g){e.initilize(a),a.lockDeferred=g.getLicenseStatus(),a.showIfLicenseValid=function(){return a.licensed||a.underTrial||"/Licensing"===c.path()},a.isAppPart=window.parent!==window,a.lockDeferred.then(function(b){a.underTrial=b.status===f.UnderTrial,a.licensed=b.status===f.Licensed,a.trialExpired=b.status===f.TrialExpired,a.licenseNotValid=b.status===f.LicenseNotValid,a.daysLeft=b.daysLeft},function(a){alert(a)})}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ManageFaqSetCtrl",["$scope","$sce","faqService","$location","faqSetModel","processing","$modal","$routeParams",function(a,b,c,d,e,f,g,h){f.initilize(a),e.faqSetName=h.folderUrl,a.faqSetModel=e,a.activeTab="tab1",c.faqRepository.folder=h.folderUrl,a.viewDeferred=c.faqRepository.getOrderedItems(),a.viewDeferred.then(function(b){Array.forEach(b,function(a){a.isShown=a.expanded}),a.faqItems=b,a.$apply()},function(a){alert(a.message)}),a.newFaq=function(){a.go(String.format("/ManageFaqSet/{0}/faq/new",h.folderUrl))},a.editFaq=function(b){a.go(String.format("/ManageFaqSet/{0}/faq/edit/{1}",h.folderUrl,b.id))},a.deleteFaq=function(b){var d=g.open({templateUrl:"deleteFaqModal.html",controller:"ModalInstanceCtrl",size:"sm"});d.result.then(function(){a.viewDeferred=c.faqRepository.deleteItem(b),a.viewDeferred.then(function(){var c=-1;Array.forEach(a.faqItems,function(a,d){return a.id===b.id?void(c=d):void 0}),c>-1&&a.faqItems.splice(c,1),a.$apply()},function(a){alert(a.message)})},function(){})},a.sortableOptions={placeholder:"sortable-placeholder",stop:function(){Array.forEach(a.faqItems,function(a,b){a.order=b}),a.viewDeferred=c.faqRepository.updateOrdering(a.faqItems),a.viewDeferred.then(function(){},function(a){alert(a.message)})}}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ModalInstanceCtrl",["$modalInstance","$scope","processing","$location",function(a,b,c){c.initilize(b),b.ok=function(){a.close()},b.cancel=function(){a.dismiss("cancel")}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("RegisterAppCtrl",["$scope","faqService","processing","$q","$window","ngToast","licenseStatus","licensing",function(a,b,c,d,e,f,g,h){c.initilize(a),a.lockDeferred=d.defer(),h.getLicenseStatus().then(function(c){a.underTrial=c.status===g.UnderTrial,a.licensed=c.status===g.Licensed,a.trialExpired=c.status===g.TrialExpired,a.licenseNotValid=c.status===g.LicenseNotValid,a.licenseKey=c.licenseKey,b.webService.getHostWebId().then(function(b){a.hostWebId=b,a.lockDeferred.resolve(),a.$apply()},function(b){a.lockDeferred.reject(),alert(b)})},function(b){a.lockDeferred.reject(),alert(b)}),a.applyLicense=function(){h.setLicense(a.licenseKey).then(function(){f.create({content:a.Resources.LicenseApplied}),a.$apply(),setTimeout(function(){e.location.reload()},1e3)},function(a){alert(a)})}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("SelectFaqForEditCtrl",["processing","$scope","faqService","$modal","$jq",function(a,b,c,d,e){a.initilize(b),b.viewDeferred=c.faqRepository.getRootFolders(),b.viewDeferred.then(function(a){b.folders=a,c.faqRepository.folder=null,b.$apply()},function(a){alert(a.message)}),b.editFaqSet=function(a){b.go(String.format("/ManageFaqSet/{0}",a.title))},b.deleteFaqSet=function(a){var e=d.open({templateUrl:"deleteFaqModal.html",controller:"ModalInstanceCtrl",size:"sm"});e.result.then(function(){b.viewDeferred=c.faqRepository.deleteItem(a),b.viewDeferred.then(function(){var c=-1;Array.forEach(b.folders,function(b,d){return b.id===a.id?void(c=d):void 0}),c>-1&&b.folders.splice(c,1),b.$apply()},function(a){alert(a.message)})},function(){})},b.revertFolderName=function(a,b){b.title=b.initialName,a.changed=a.submitted=!1},b.initScope=function(a,b){b.initialName=b.title,a.$watch("folder.title",function(){a.folder.fileLeafRef=a.folder.title})},b.changeFolderName=function(a,d){if(a.submitted=!0,!a.faqSetForm.$invalid){var f=e.grep(a.folders,function(a){return a.id===d.id&&a!=d?!0:!1}).length>0;if(f)return void(a.folderExists=!0);b.viewDeferred=c.faqRepository.saveItem(d),b.viewDeferred.then(function(){d.initialName=d.title,a.changed=a.submitted=!1,b.$apply()},function(c){a.folderExists=c.errorCode===FAQ.ErrorCodes.FolderAlreadyExists,a.illegalCharacter=c.errorCode===FAQ.ErrorCodes.IllegalName,a.folderExists||a.illegalCharacter||(a.commonError=!0,a.errorMessage=c.message),b.$apply()})}}}])}(),function(a){"use strict";angular.module("FaqApp.directives").directive("block",["$log",function(b){return a.blockUI.defaults.css={},a.blockUI.defaults.overlayCSS.backgroundColor="#FFF",a.blockUI.defaults.overlayCSS.cursor="default",{retstrict:"A",scope:{lock:"=block"},link:function(a,c){a.$watch("lock",function(){a.lock&&angular.isFunction(a.lock["finally"])&&(b.debug("Blocking..."),c.addClass("locked").block({message:"<img src='Content/img/ajax-loader.gif'>"}),a.lock["finally"](function(){b.debug("Unblocking..."),c.removeClass("locked").unblock()}))})}}}])}(jQuery),function(){"use strict";angular.module("FaqApp.directives").directive("contenteditable",[function(){return{require:"ngModel",link:function(a,b,c,d){b.on("blur",function(){a.$apply(function(){d.$setViewValue(b.html())})}),d.$render=function(){b.html(d.$viewValue)},d.$render()}}}])}(),function(){"use strict";angular.module("FaqApp.directives").directive("faqAnimate",["$timeout",function(a){return{retstrict:"A",scope:{animatationName:"="},link:function(b,c){b.$watch("animatationName",function(d,e){if(d!==e&&d){var f;f="cshow"===d?"ng-hide":"animated "+d,c.addClass(f),setTimeout(function(){c.removeClass(f)},1500)}a(function(){b.animatationName=""},100)})}}}])}(),function(){"use strict";angular.module("FaqApp.directives").directive("faqShow",["$animate","faqService","$log",function(a,b,c){return{retstrict:"A",scope:{faqShow:"=",animatationName:"="},link:function(a,d){a.$watch("faqShow",function(e,f){c.debug(e+"_"+f),e!==f&&(e?(d.removeClass("ng-hide"),b.resizeParent(),d.addClass("animated "+a.animatationName),c.debug("addClass"),setTimeout(function(){d.removeClass("animated "+a.animatationName)},1e3)):(d.addClass("ng-hide"),c.debug("hide"),b.resizeParent()))})}}}])}(),function(){"use strict";angular.module("FaqApp.directives").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}})}(),function(){"use strict";angular.module("FaqApp.directives").directive("spEditable",[function(){return{restrict:"A",scope:{},link:function(a,b){b.addClass("ms-rte-layoutszone-inner-editable ms-rtestate-write").attr("role","textbox").attr("aria-haspopup","true").attr("contentEditable","true").attr("aria-autocomplete","both").attr("aria-autocomplete","both").attr("aria-multiline","true")}}}])}(),function(){"use strict";angular.module("FaqApp.filters").filter("highlight",["$sce",function(a){return function(b,c){return c&&(b=b.replace(new RegExp(c,"gi"),"<span class='highlighted'>$&</span>")),a.trustAsHtml(b)}}])}(),function(){"use strict";var a={};a.cshow=FAQRS.SimpleAnimation,a.fadeIn=FAQRS.FadeIn,a.fadeInUp=FAQRS.FadeInUp,a.fadeInRight=FAQRS.FadeInRight,a.fadeInLeft=FAQRS.FadeInLeft,a.fadeInDown=FAQRS.FadeInDown,a.bounceIn=FAQRS.BounceIn,a.bounceInLeft=FAQRS.BounceInLeft,a.bounceInRight=FAQRS.BounceInRight,a.bounceInUp=FAQRS.BounceInUp,a.bounceInDown=FAQRS.BounceInDown,a.flip=FAQRS.Flip,a.flipInX=FAQRS.FlipInX,a.flipInY=FAQRS.FlipInY,a.rotateIn=FAQRS.RotateIn,a.rotateInDownLeft=FAQRS.RotateInDownLeft,a.rotateInDownRight=FAQRS.RotateInDownRight,a.rotateInUpLeft=FAQRS.RotateInUpLeft,a.rotateInUpRight=FAQRS.RotateInUpRight,a.zoomIn=FAQRS.ZoomIn,a.zoomInUp=FAQRS.ZoomInUp,a.zoomInRight=FAQRS.ZoomInRight,a.zoomInLeft=FAQRS.ZoomInLeft,a.zoomInDown=FAQRS.ZoomInDown,a.pulse=FAQRS.Pulse,a.swing=FAQRS.Swing,a.tada=FAQRS.Tada,a.lightSpeedIn=FAQRS.LightSpeedIn,a.rollIn=FAQRS.RollIn,a.wobble=FAQRS.Wobble,angular.module("FaqApp.services").value("animationList",a)}(),function(){"use strict";angular.module("FaqApp.services").factory("context",[function(){function a(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}function b(b){var c=a(b);return c.endsWith("/")?c:c+"/"}var c=a("editmode"),d=!1;return c&&(d=!!parseInt(c,10)),{editMode:d,spHostUrl:b("SPHostUrl"),spAppWebUrl:b("SPAppWebUrl"),wpId:a("wpId"),senderId:a("SenderId")}}])}(),function(){"use strict";angular.module("FaqApp.services").factory("faqService",["context",function(a){return{appPartConfigRepository:new AppPartsConfigRepository(FAQ.Lists.AppPartsConfigUrl),faqRepository:new FaqRepository(FAQ.Lists.FaqUrl),webService:FAQ.SPWebService,resizeParent:function(){if(window.parent!==window){var b=$jq("#s4-workspace"),c="<Message senderId="+a.senderId+" >resize("+b.width()+","+(b.height()+40)+")</Message>";window.parent.postMessage(c,a.spHostUrl)}}}}])}(),function(){"use strict";angular.module("FaqApp.services").factory("faqSetModel",[function(){return{faqSetName:""}}])}(),function(){"use strict";angular.module("FaqApp.services").factory("$jq",function(){return window.jQuery})}(),function(){"use strict";angular.module("FaqApp.services").value("licenseStatus",{UnderTrial:1,Licensed:2,TrialExpired:3,LicenseNotValid:4}),angular.module("FaqApp.services").factory("licensing",["context","faqService","$q","licenseStatus",function(a,b,c,d){var e="_faq_license_",f="_faq_date_installed",g=30,h="Content/rsa_public_key.txt",i=c.defer(),j=function(a){var b=moment(),c=b.diff(a,"days");i.resolve(c>g?{status:d.TrialExpired}:{status:d.UnderTrial,daysLeft:g-c})};return{getLicenseStatus:function(){var a=b.webService.webProperties.get(e),g=b.webService.getHostWebId();return c.all([a,g]).then(function(a){var c=a[0],e=a[1];c?$jq.ajax({url:h,success:function(a){var b=new JSEncrypt;b.setPublicKey(a);var f=b.decrypt(c);i.resolve(e===f?{status:d.Licensed,licenseKey:c}:{status:d.LicenseNotValid,licenseKey:c})},dataType:"text"}):b.webService.webProperties.get(f).then(function(a){if(a)j(moment(a));else{var c=new Date;b.webService.webProperties.set(f,c).then(function(){j(moment(c))})}},function(a){i.reject(a)})},function(a){i.reject(a)}),i.promise},setLicense:function(a){return b.webService.webProperties.set(e,a)}}}])}(),function(a){"use strict";angular.module("FaqApp.services").factory("processing",["$sce","$location","faqService",function(b,c,d){return{initilize:function(e){e.Resources=FAQRS,e.trustedHtml=function(a){return b.trustAsHtml(a)},e.go=function(a){c.path(a)},e.resizeParent=d.resizeParent,e.getInnerText=function(b){return a(String.format("<div>{0}</div>",b)).text().trim()}}}}])}(jQuery);