(function(){"use strict";angular.module("FaqApp.controllers",[]);angular.module("FaqApp.services",[]);angular.module("FaqApp.directives",[]);angular.module("FaqApp.filters",[]);angular.module("ViewFaqApp",["FaqApp.controllers","FaqApp.services","FaqApp.directives","FaqApp.filters","ngRoute","ngSanitize","ngAnimate","ui.bootstrap","ui.sortable"]).config(["$routeProvider",function(n){n.when("/",{templateUrl:"partials/FaqList.html",controller:"FaqViewCtrl"}).otherwise({redirectTo:"/"})}]).config(["$logProvider",function(n){n.debugEnabled(window.faq_is_debug)}]);angular.module("EditFaqApp",["FaqApp.controllers","FaqApp.services","FaqApp.directives","ngRoute","ngSanitize","ngAnimate","ui.bootstrap","ui.sortable","ngToast"]).config(["$routeProvider",function(n){n.when("/",{templateUrl:"partials/EditMode/FaqEditStartScreen.html",controller:"FaqEditCtrl"}).when("/SelectForEdit",{templateUrl:"partials/EditMode/SelectFaqSetForEdit.html",controller:"SelectFaqForEditCtrl"}).when("/ConnectFaqSet",{templateUrl:"partials/EditMode/ConnectFaqSet.html",controller:"ConnectFaqSetCtrl"}).when("/NewFaqSet",{templateUrl:"partials/EditMode/NewFaqSet.html",controller:"FaqEditCtrl"}).when("/ManageFaqSet/:folderUrl",{templateUrl:"partials/EditMode/ManageFaqSet.html",controller:"ManageFaqSetCtrl"}).when("/ManageFaqSet/:folderUrl/faq/edit/:faqId",{templateUrl:"partials/EditMode/CreateEditFaq.html",controller:"CreateEditFaqCtrl"}).when("/ManageFaqSet/:folderUrl/faq/new",{templateUrl:"partials/EditMode/CreateEditFaq.html",controller:"CreateEditFaqCtrl"}).when("/Licensing",{templateUrl:"partials/EditMode/LicenseRequest.html",controller:"RegisterAppCtrl"}).when("/ContactDev",{templateUrl:"partials/EditMode/ContactDeveloper.html",controller:"ContactDeveloperCtrl"}).otherwise({redirectTo:"/"})}]).config(["$logProvider",function(n){n.debugEnabled(window.faq_is_debug)}])})(),function(n){"use strict";angular.module("FaqApp.services").factory("processing",["$sce","$location","faqService",function(t,i,r){return{initilize:function(u){u.Resources=FAQRS;u.trustedHtml=function(n){return t.trustAsHtml(n)};u.go=function(n){i.path(n)};u.resizeParent=r.resizeParent;u.getInnerText=function(t){return n(String.format("<div>{0}<\/div>",t)).text().trim()}}}}])}(jQuery),function(){"use strict";angular.module("FaqApp.services").factory("faqSetModel",[function(){return{faqSetName:""}}])}(),function(){"use strict";angular.module("FaqApp.services").factory("faqService",["context",function(n){return{appPartConfigRepository:new AppPartsConfigRepository(FAQ.Lists.AppPartsConfigUrl),faqRepository:new FaqRepository(FAQ.Lists.FaqUrl),webService:FAQ.SPWebService,resizeParent:function(){if(window.parent!==window){var t=$jq("#s4-workspace"),i="<Message senderId="+n.senderId+" >resize("+t.width()+","+(t.height()+40)+")<\/Message>";window.parent.postMessage(i,n.spHostUrl)}}}}])}(),function(){"use strict";angular.module("FaqApp.services").factory("context",[function(){function n(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}function t(t){var i=n(t);return i.endsWith("/")?i:i+"/"}var i=n("editmode"),r=!1;return i&&(r=!!parseInt(i,10)),{editMode:r,spHostUrl:t("SPHostUrl"),spAppWebUrl:t("SPAppWebUrl"),wpId:n("wpId"),senderId:n("SenderId")}}])}(),function(){"use strict";angular.module("FaqApp.services").factory("$jq",function(){return window.jQuery})}(),function(){"use strict";var n={};n.cshow=FAQRS.SimpleAnimation;n.fadeIn=FAQRS.FadeIn;n.fadeInUp=FAQRS.FadeInUp;n.fadeInRight=FAQRS.FadeInRight;n.fadeInLeft=FAQRS.FadeInLeft;n.fadeInDown=FAQRS.FadeInDown;n.bounceIn=FAQRS.BounceIn;n.bounceInLeft=FAQRS.BounceInLeft;n.bounceInRight=FAQRS.BounceInRight;n.bounceInUp=FAQRS.BounceInUp;n.bounceInDown=FAQRS.BounceInDown;n.flip=FAQRS.Flip;n.flipInX=FAQRS.FlipInX;n.flipInY=FAQRS.FlipInY;n.rotateIn=FAQRS.RotateIn;n.rotateInDownLeft=FAQRS.RotateInDownLeft;n.rotateInDownRight=FAQRS.RotateInDownRight;n.rotateInUpLeft=FAQRS.RotateInUpLeft;n.rotateInUpRight=FAQRS.RotateInUpRight;n.zoomIn=FAQRS.ZoomIn;n.zoomInUp=FAQRS.ZoomInUp;n.zoomInRight=FAQRS.ZoomInRight;n.zoomInLeft=FAQRS.ZoomInLeft;n.zoomInDown=FAQRS.ZoomInDown;n.pulse=FAQRS.Pulse;n.swing=FAQRS.Swing;n.tada=FAQRS.Tada;n.lightSpeedIn=FAQRS.LightSpeedIn;n.rollIn=FAQRS.RollIn;n.wobble=FAQRS.Wobble;angular.module("FaqApp.services").value("animationList",n)}(),function(){"use strict";angular.module("FaqApp.services").value("licenseStatus",{UnderTrial:1,Licensed:2,TrialExpired:3,LicenseNotValid:4});angular.module("FaqApp.services").factory("licensing",["context","faqService","$q","licenseStatus",function(n,t,i,r){var f="_faq_license_",e="_faq_date_installed",o=30,h="Content/rsa_public_key.txt",u=i.defer(),s=function(n){var i=moment(),t=i.diff(n,"days");t>o?u.resolve({status:r.TrialExpired}):u.resolve({status:r.UnderTrial,daysLeft:o-t})};return{getLicenseStatus:function(){var n=t.webService.webProperties.get(f),o=t.webService.getHostWebId();return i.all([n,o]).then(function(n){var i=n[0],f=n[1];i?$jq.ajax({url:h,success:function(n){var t=new JSEncrypt,e;t.setPublicKey(n);e=t.decrypt(i);f===e?u.resolve({status:r.Licensed,licenseKey:i}):u.resolve({status:r.LicenseNotValid,licenseKey:i})},dataType:"text"}):t.webService.webProperties.get(e).then(function(n){if(n)s(moment(n));else{var i=new Date;t.webService.webProperties.set(e,i).then(function(){s(moment(i))})}},function(n){u.reject(n)})},function(n){u.reject(n)}),u.promise},setLicense:function(n){return t.webService.webProperties.set(f,n)}}}])}(),function(){"use strict";angular.module("FaqApp.directives").directive("spEditable",[function(){return{restrict:"A",scope:{},link:function(n,t){t.addClass("ms-rte-layoutszone-inner-editable ms-rtestate-write").attr("role","textbox").attr("aria-haspopup","true").attr("contentEditable","true").attr("aria-autocomplete","both").attr("aria-autocomplete","both").attr("aria-multiline","true")}}}])}(),function(){"use strict";angular.module("FaqApp.directives").directive("ngEnter",function(){return function(n,t,i){t.bind("keydown keypress",function(t){t.which===13&&(n.$apply(function(){n.$eval(i.ngEnter)}),t.preventDefault())})}})}(),function(){"use strict";angular.module("FaqApp.directives").directive("faqShow",["$animate","faqService","$log",function(n,t,i){return{retstrict:"A",scope:{faqShow:"=",animatationName:"="},link:function(n,r){n.$watch("faqShow",function(u,f){i.debug(u+"_"+f);u!==f&&(u?(r.removeClass("ng-hide"),t.resizeParent(),r.addClass("animated "+n.animatationName),i.debug("addClass"),setTimeout(function(){r.removeClass("animated "+n.animatationName)},1e3)):(r.addClass("ng-hide"),i.debug("hide"),t.resizeParent()))})}}}])}(),function(){"use strict";angular.module("FaqApp.directives").directive("contenteditable",[function(){return{require:"ngModel",link:function(n,t,i,r){t.on("blur",function(){n.$apply(function(){r.$setViewValue(t.html())})});r.$render=function(){t.html(r.$viewValue)};r.$render()}}}])}(),function(n){"use strict";angular.module("FaqApp.directives").directive("block",["$log",function(t){return n.blockUI.defaults.css={},n.blockUI.defaults.overlayCSS.backgroundColor="#FFF",n.blockUI.defaults.overlayCSS.cursor="default",{retstrict:"A",scope:{lock:"=block"},link:function(n,i){n.$watch("lock",function(){n.lock&&angular.isFunction(n.lock.finally)&&(t.debug("Blocking..."),i.addClass("locked").block({message:"<img src='Content/img/ajax-loader.gif'>"}),n.lock.finally(function(){t.debug("Unblocking...");i.removeClass("locked").unblock()}))})}}}])}(jQuery),function(){"use strict";angular.module("FaqApp.directives").directive("faqAnimate",["$timeout",function(n){return{retstrict:"A",scope:{animatationName:"="},link:function(t,i){t.$watch("animatationName",function(r,u){if(r!==u&&r){var f;f=r==="cshow"?"ng-hide":"animated "+r;i.addClass(f);setTimeout(function(){i.removeClass(f)},1500)}n(function(){t.animatationName=""},100)})}}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("SelectFaqForEditCtrl",["processing","$scope","faqService","$modal","$jq",function(n,t,i,r,u){n.initilize(t);t.viewDeferred=i.faqRepository.getRootFolders();t.viewDeferred.then(function(n){t.folders=n;i.faqRepository.folder=null;t.$apply()},function(n){alert(n.message)});t.editFaqSet=function(n){t.go(String.format("/ManageFaqSet/{0}",n.title))};t.deleteFaqSet=function(n){var u=r.open({templateUrl:"deleteFaqModal.html",controller:"ModalInstanceCtrl",size:"sm"});u.result.then(function(){t.viewDeferred=i.faqRepository.deleteItem(n);t.viewDeferred.then(function(){var i=-1;Array.forEach(t.folders,function(t,r){if(t.id===n.id){i=r;return}});i>-1&&t.folders.splice(i,1);t.$apply()},function(n){alert(n.message)})},function(){})};t.revertFolderName=function(n,t){t.title=t.initialName;n.changed=n.submitted=!1};t.initScope=function(n,t){t.initialName=t.title;n.$watch("folder.title",function(){n.folder.fileLeafRef=n.folder.title})};t.changeFolderName=function(n,r){if(n.submitted=!0,!n.faqSetForm.$invalid){var f=u.grep(n.folders,function(n){return n.id===r.id&&n!=r?!0:!1}).length>0;if(f){n.folderExists=!0;return}t.viewDeferred=i.faqRepository.saveItem(r);t.viewDeferred.then(function(){r.initialName=r.title;n.changed=n.submitted=!1;t.$apply()},function(i){n.folderExists=i.errorCode===FAQ.ErrorCodes.FolderAlreadyExists;n.illegalCharacter=i.errorCode===FAQ.ErrorCodes.IllegalName;n.folderExists||n.illegalCharacter||(n.commonError=!0,n.errorMessage=i.message);t.$apply()})}}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ModalInstanceCtrl",["$modalInstance","$scope","processing","$location",function(n,t,i){i.initilize(t);t.ok=function(){n.close()};t.cancel=function(){n.dismiss("cancel")}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("FaqViewCtrl",["$scope","$sce","$q","$timeout","faqService","processing","context","$log","$window",function(n,t,i,r,u,f,e,o,s){var h,l,v,a,y,c;if(f.initilize(n),l=2,v=200,n.faqItems=null,n.appPartInitialized=!0,e.editMode){a=String.format("{0}FaqAppPartEditMode.aspx{1}/#/ConnectFaqSet",e.spAppWebUrl,s.location.search);o.debug(a);s.location.href=a;return}y=e.wpId;c=i.defer();n.viewDeferred=c.promise;n.changeVisibility=function(t,i){n.forceExpand||(i.playingAnimation=h.faqSetSettings.animation,t.isShown=!t.isShown,t.expanded=!t.expanded)};n.clearSearch=function(){n.searchText&&(n.searchText="",r(function(){u.resizeParent()},100))};n.filterByQuestionAnswer=function(t){if(!n.searchText)return!0;var i=n.searchText.toLowerCase();return t.question.toLowerCase().indexOf(i)!==-1||t.answer.toLowerCase().indexOf(i)!==-1};n.resize=function(){r(function(){u.resizeParent()},100)};u.appPartConfigRepository.getByAppPartId(y).then(function(t){t?u.faqRepository.getItemById(t.configData.folderId).then(function(t){h=t;u.faqRepository.folder=h.title;n.playingAnimation=h.faqSetSettings.animation;n.showPlusSymbol=h.faqSetSettings.showPlusSymbol;n.forceExpand=h.faqSetSettings.useAnimation===!1;n.showSearch=h.faqSetSettings.searchEnabled;u.faqRepository.getItems().then(function(t){Array.forEach(t,function(n){n.isShown=n.expanded});n.faqItems=t;c.resolve();n.$apply();u.resizeParent();o.debug("faqService.resizeParent()");var i=setInterval(function(){l--;l===0&&clearInterval(i);u.resizeParent();o.debug("faqService.resizeParent() - interval")},1*v)},function(n){c.resolve();alert(n.message)})},function(n){c.resolve();alert(n.message)}):(n.appPartInitialized=!1,c.resolve(),n.$apply())},function(n){c.resolve();alert(n.message)})}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ManageFaqSetCtrl",["$scope","$sce","faqService","$location","faqSetModel","processing","$modal","$routeParams",function(n,t,i,r,u,f,e,o){f.initilize(n);u.faqSetName=o.folderUrl;n.faqSetModel=u;n.activeTab="tab1";i.faqRepository.folder=o.folderUrl;n.viewDeferred=i.faqRepository.getOrderedItems();n.viewDeferred.then(function(t){Array.forEach(t,function(n){n.isShown=n.expanded});n.faqItems=t;n.$apply()},function(n){alert(n.message)});n.newFaq=function(){n.go(String.format("/ManageFaqSet/{0}/faq/new",o.folderUrl))};n.editFaq=function(t){n.go(String.format("/ManageFaqSet/{0}/faq/edit/{1}",o.folderUrl,t.id))};n.deleteFaq=function(t){var r=e.open({templateUrl:"deleteFaqModal.html",controller:"ModalInstanceCtrl",size:"sm"});r.result.then(function(){n.viewDeferred=i.faqRepository.deleteItem(t);n.viewDeferred.then(function(){var i=-1;Array.forEach(n.faqItems,function(n,r){if(n.id===t.id){i=r;return}});i>-1&&n.faqItems.splice(i,1);n.$apply()},function(n){alert(n.message)})},function(){})};n.sortableOptions={placeholder:"sortable-placeholder",stop:function(){Array.forEach(n.faqItems,function(n,t){n.order=t});n.viewDeferred=i.faqRepository.updateOrdering(n.faqItems);n.viewDeferred.then(function(){},function(n){alert(n.message)})}}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("CreateEditFaqCtrl",["$scope","$sce","$routeParams","$q","faqService","processing","ngToast",function(n,t,i,r,u,f,e){function s(){n.faqItem=o;n.$watch("faqItem.question",function(){n.question=n.getInnerText(o.question)});n.$watch("faqItem.answer",function(){n.answer=n.getInnerText(o.answer)});n.saveFaq=function(){if(n.submitted=!0,!n.faqForm.$invalid){var t=r.defer();n.viewDeferred=t.promise;u.faqRepository.getLastItem().then(function(r){o.order||(o.order=r?r.id+1:1);u.faqRepository.saveItem(o).then(function(){e.create({content:n.Resources.QuestionSaved});t.resolve();n.go(String.format("/ManageFaqSet/{0}",i.folderUrl))},function(n){t.resolve();alert(n.message)})},function(n){t.resolve();alert(n.message)})}};n.back=function(){n.go(String.format("/ManageFaqSet/{0}",i.folderUrl))}}f.initilize(n);var o;u.faqRepository.folder=i.folderUrl;i.faqId?u.faqRepository.getItemById(parseInt(i.faqId,10)).then(function(t){o=t;s();n.$apply()},function(n){alert(n.message)}):(o=new FaqListItem,o.expanded=!0,s())}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("FaqEditCtrl",["$scope","$sce","faqService","$location","faqSetModel","processing","context",function(n,t,i,r,u,f,e){f.initilize(n);u.faqSetName="";n.faqSetModel=u;n.wpIdProvided=!!e.wpId;n.newFaqSet=function(){(n.submitted=!0,n.faqForm.$invalid)||(n.createFolderDeferred=i.faqRepository.createFaqFolder(u.faqSetName,{useAnimation:!1,showPlusSymbol:!0,animation:"cshow",searchEnabled:!1}),n.createFolderDeferred.then(function(){n.go(String.format("/ManageFaqSet/{0}",u.faqSetName));n.$apply()},function(t){n.folderExists=t.errorCode===FAQ.ErrorCodes.FolderAlreadyExists;n.illegalCharacter=t.errorCode===FAQ.ErrorCodes.IllegalName;n.folderExists||n.illegalCharacter||(n.commonError=!0,n.errorMessage=t.message);n.$apply()}))}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ConnectFaqSetCtrl",["processing","$scope","$q","$jq","faqService","context","ngToast",function(n,t,i,r,u,f,e){n.initilize(t);var o=f.wpId;t.viewDeferred=i.all([u.faqRepository.getRootFolders(),u.appPartConfigRepository.getByAppPartId(o)]);t.viewDeferred.then(function(n){var u,i;t.folders=n[0];u=n[1];u?(i=r.grep(t.folders,function(n){return n.id===u.configData.folderId?!0:!1})[0],i.title=i.title+" "+t.Resources.CurrentlySelected,t.folder=i):t.folders&&t.folders.length&&(t.folder=t.folders[0])},function(n){alert(n.message)});t.connectAppPart=function(n){u.appPartConfigRepository.getByAppPartId(o).then(function(i){i||(i=new AppPartConfigListItem,i.wpId=o,i.configData={});i.configData.folderId=n.id;u.appPartConfigRepository.saveItem(i).then(function(){e.create({content:t.Resources.DataSaved});t.$apply()},function(n){alert(n.message)})},function(n){alert(n.message)})}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("CommonFaqSetSettingsCtrl",["$scope","faqService","processing","$routeParams","$timeout","$jq","animationList","ngToast",function(n,t,i,r,u,f,e,o){i.initilize(n);var s;n.viewDeferred=t.faqRepository.getRootFolders();n.viewDeferred.then(function(t){s=f.grep(t,function(n){return n.title===r.folderUrl?!0:!1})[0];n.faqSettings=s.faqSetSettings;n.setSelectedAnimation(n.faqSettings.animation)});n.setSelectedAnimation=function(t){n.selectedAnimation=e[t];n.playingAnimation=t;n.faqSettings.animation=t};n.testAnimation=function(){n.playingAnimation=n.faqSettings.animation};n.saveSettings=function(){s.faqSetSettings=n.faqSettings;n.viewDeferred=t.faqRepository.saveItem(s);o.create({content:n.Resources.DataSaved})}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("LicensingCtrl",["$scope","faqService","$location","$q","processing","licenseStatus","licensing",function(n,t,i,r,u,f,e){u.initilize(n);n.lockDeferred=e.getLicenseStatus();n.showIfLicenseValid=function(){return n.licensed||n.underTrial||i.path()==="/Licensing"};n.isAppPart=window.parent!==window;n.lockDeferred.then(function(t){n.underTrial=t.status===f.UnderTrial;n.licensed=t.status===f.Licensed;n.trialExpired=t.status===f.TrialExpired;n.licenseNotValid=t.status===f.LicenseNotValid;n.daysLeft=t.daysLeft},function(n){alert(n)})}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("RegisterAppCtrl",["$scope","faqService","processing","$q","$window","ngToast","licenseStatus","licensing",function(n,t,i,r,u,f,e,o){i.initilize(n);n.lockDeferred=r.defer();o.getLicenseStatus().then(function(i){n.underTrial=i.status===e.UnderTrial;n.licensed=i.status===e.Licensed;n.trialExpired=i.status===e.TrialExpired;n.licenseNotValid=i.status===e.LicenseNotValid;n.licenseKey=i.licenseKey;t.webService.getHostWebId().then(function(t){n.hostWebId=t;n.lockDeferred.resolve();n.$apply()},function(t){n.lockDeferred.reject();alert(t)})},function(t){n.lockDeferred.reject();alert(t)});n.applyLicense=function(){o.setLicense(n.licenseKey).then(function(){f.create({content:n.Resources.LicenseApplied});n.$apply();setTimeout(function(){u.location.reload()},1e3)},function(n){alert(n)})}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ContactDeveloperCtrl",["$scope","processing",function(n,t){t.initilize(n)}])}(),function(){"use strict";angular.module("FaqApp.filters").filter("highlight",["$sce",function(n){return function(t,i){return i&&(t=t.replace(new RegExp(i,"gi"),"<span class='highlighted'>$&<\/span>")),n.trustAsHtml(t)}}])}();
//# sourceMappingURL=app_bundle.min.js.map
